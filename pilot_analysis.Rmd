---
title: "Kid AoA expeirment analysis"
author: "Ashley Leung, Ben Morris, and Dan Yurovsky"
date: '`r Sys.Date()`'
output: 
  html_document:
  toc: false
number_sections: false
theme: lumen
toc_float: false
code_folding: hide
---

```{r load-libraries, warning = F, message = F}
library(here)
library(janitor)
library(ggthemes)
library(tidyverse)
library(ggrepel)
library(lme4)
library(lmerTest)
library(broom)
library(broom.mixed)

theme_set(theme_classic(base_size = 14))
```

```{r load-data,, warning = F, message = F}
#adjust this total n to grab all the participants data below
n <- 16

pilot_data <- read_csv(here("pilot_data/pilot_data.csv")) %>%
  clean_names() %>%
  pivot_longer(cols = paste("p", seq(1:n), sep=''), names_to = "participant") %>%
  pivot_wider(names_from = subject_number, values_from = value) %>%
  pivot_longer(cols = ball:penguin, names_to = "word", values_to = "judgment") %>%
  mutate(type = if_else(word == "ball", "practice", "test"),
         judgment = as.numeric(judgment))

kuperman_aoas <- read_csv(here("corpus_data/kuperman_aoas.csv"))
```


```{r plot-pilot-data}
test_data <- pilot_data %>%
  filter(type == "test") %>%
  left_join(kuperman_aoas, by = "word") %>%
  rowwise() %>%
  #cleaner participant id
  mutate(participant = as.numeric(str_split(participant, "p")[[1]][2])) %>%
  mutate(age_group = case_when(
    age == 4 | age == 5 ~ "4-5-year-olds",
    age == 6 | age == 7 ~ "6-7-year-olds",
    age == 8 | age == 9 ~ "8-9-year-olds"
  ))
```

# Overall Effect

```{r}
data_overall <- test_data %>% 
  group_by(word, aoa) %>%
  summarize(judgment = mean(judgment, na.rm = T))

ggplot(data_overall, aes(x = aoa, y = judgment,
                      label = word)) + 
  geom_smooth(method = "lm") +
  geom_label_repel() + 
  xlab("Kuperman AoA estimates (adults)") +
  ylab("Kid Judgments")
```


# Each participant's judgments

```{r}
test_data %>%
  ggplot(aes(x = aoa, y = judgment,
                      label = word)) + 
  geom_jitter(aes(alpha = .2)) +
  geom_smooth(method = "lm") + 
  facet_wrap( ~ participant)
```


#### Individuals but ordered by age (group)

```{r, fig.height=8}
within_age_subj <- test_data %>%
  group_by(age_group) %>%
  distinct(participant) %>%
  mutate(within_age_subj = seq(n()))

tmp <- left_join(test_data, within_age_subj, by=c('participant', 'age_group'))
  
tmp %>%
  ggplot(aes(x = aoa, y = judgment, group = age_group, color = age_group,
                      label = word)) + 
  geom_jitter(aes(alpha = .2)) +
  geom_smooth(method = "lm") + 
  facet_grid(age_group ~ within_age_subj) +
  ggtitle("Individual Participant's Judgments, split by age groups") +
  coord_cartesian(ylim= c(0,7))
```


# Averages by age group (4-5, 6-7, 8-9)

```{r}
data_by_age <- test_data %>% 
  group_by(age_group, word, aoa) %>%
  summarize(judgment = mean(judgment, na.rm=T))

ggplot(data_by_age, aes(x = aoa, y = judgment, group = age_group,
                      label = word)) + 
  geom_label_repel() + 
  geom_smooth(method = "lm") + 
  facet_grid(.~age_group)
```



  
# Model

```{r model}
model <- test_data %>%
  mutate(centered_judgment = judgment - 3.5) %>%
  lm(judgment ~ aoa * age + h, data = .)

tidy(model) 
```
